<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100vh;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(90deg, #4a6cf7, #7a52d4);
            color: white;
            padding: 15px 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 70px;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-left: 50px;
        }

        .hamburger-menu {
            position: absolute;
            left: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .hamburger-menu:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 999;
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .menu-btn {
            width: 100%;
            padding: 12px 15px;
            background: #4a6cf7;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .menu-btn:hover {
            background: #3a5ce5;
            transform: translateX(5px);
        }

        .menu-btn.active {
            background: #ff6b6b;
        }

        .clear-btn {
            background: #ff6b6b;
            width: 100%;
            padding: 12px 15px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .clear-btn:hover {
            background: #ff5252;
            transform: translateX(5px);
        }

        .memory-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            background: #f9f9f9;
        }

        .memory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #e6eeff;
            border-radius: 15px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #4a6cf7;
            animation: memoryItemPop 0.3s ease;
        }

        @keyframes memoryItemPop {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .memory-item:hover {
            background: #4a6cf7;
            color: white;
        }

        .delete-memory {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-memory:hover {
            background: #ff5252;
            transform: scale(1.2);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #f5f7ff;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            animation: messageSlide 0.3s ease;
            position: relative;
        }

        @keyframes messageSlide {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4a6cf7, #7a52d4);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .analysis-message {
            align-self: flex-start;
            background-color: #fff8e1;
            border: 1px solid #ffeaa7;
            border-bottom-left-radius: 5px;
            font-size: 0.85rem;
            color: #856404;
        }

        .thinking {
            align-self: flex-start;
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            font-style: italic;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: thinkingPulse 1.5s infinite;
        }

        @keyframes thinkingPulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .thinking-dots {
            display: flex;
            gap: 3px;
        }

        .thinking-dots span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #666;
            animation: dotPulse 1.5s infinite;
        }

        .thinking-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .thinking-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes dotPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }

        .input-container {
            display: flex;
            padding: 15px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
            gap: 10px;
            flex-shrink: 0;
        }

        #user-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            transition: all 0.3s;
        }

        #user-input:focus {
            border-color: #4a6cf7;
            box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
        }

        #send-btn {
            background: linear-gradient(135deg, #4a6cf7, #7a52d4);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        #send-btn:hover {
            transform: scale(1.1);
        }

        #send-btn:active {
            transform: scale(0.95);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 998;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .sidebar {
                width: 280px;
            }
            
            .header h1 {
                font-size: 1.3rem;
                margin-left: 40px;
            }
            
            .message {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 12px 15px;
                min-height: 60px;
            }
            
            .header h1 {
                font-size: 1.2rem;
                margin-left: 35px;
            }
            
            .hamburger-menu {
                left: 15px;
                font-size: 1.3rem;
            }
            
            .sidebar {
                width: 100%;
                left: -100%;
            }
            
            .chat-container {
                padding: 15px;
            }
            
            .input-container {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="hamburger-menu">☰</button>
            <h1>Combot</h1>
        </div>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <h3>Modus</h3>
                <button class="menu-btn" id="learn-mode-btn">Leermodus</button>
                <button class="menu-btn" id="analysis-btn">Analyse Aan</button>
            </div>
            
            <div class="sidebar-section">
                <h3>Geheugen</h3>
                <div class="memory-list" id="memory-list">
                    <!-- Geleerde items komen hier -->
                </div>
                <button class="clear-btn" id="clear-all-memory">Alles Wissen</button>
            </div>
        </div>
        
        <div class="overlay" id="overlay"></div>
        
        <div class="chat-container" id="chat-container">
            <!-- Hier komen de berichten -->
        </div>
        
        <div class="input-container">
            <input type="text" id="user-input" placeholder="Typ je bericht hier... of 'leer vraag = antwoord'">
            <button id="send-btn">➤</button>
        </div>
    </div>

    <script>
        // Initialiseer Combot met standaard kennis en GitHub data
        async function initializeBot() {
            // Controleer of er data in Local Storage staat
            const storedKnowledgeBase = localStorage.getItem('combotKnowledgeBase');
            const storedLearnedPatterns = localStorage.getItem('combotLearnedPatterns');
            const storedBotPersonality = localStorage.getItem('combotPersonality');
            const storedStats = localStorage.getItem('combotStats');
            const storedLearnedQA = localStorage.getItem('combotLearnedQA');
            const storedAnalysisMode = localStorage.getItem('combotAnalysisMode');
            
            // Standaard kennisbasis als er niets is opgeslagen
            const defaultKnowledgeBase = {
                begroeting: [
                    "Hallo! Leuk je te ontmoeten!",
                    "Hoi! Hoe gaat het?",
                    "Goedendag! Klaar voor een leuk gesprek?",
                    "Hé daar! Wat leuk dat je er bent!"
                ],
                boos: [
                    "Waarom ben je zo boos?",
                    "Laten we rustig praten.",
                    "Ik begrijp dat je boos bent, maar schelden helpt niet.",
                    "Oei, dat klinkt niet vriendelijk."
                ],
                compliment: [
                    "Wat aardig van je! Dankjewel!",
                    "Dank je wel, dat waardeer ik!",
                    "Wat een leuk compliment! Jij bent ook geweldig!",
                    "Dankjewel, dat maakt me blij!"
                ],
                tip: [
                    "Weet je wat leuk is? Lachen is gezond!",
                    "Een goede tip: geniet van de kleine dingen!",
                    "Probeer eens iets nieuws vandaag!",
                    "Een glimlach kost niets, maar is veel waard!"
                ],
                grap: [
                    "Waarom gaan programmeurs altijd met de verkeerde voet uit bed? Omdat ze {alert} gebruiken in plaats van {console.log}!",
                    "Hoe noem je een koe zonder poten? Grondrund!",
                    "Waarom kon de computer niet eten? Hij had te veel cookies!",
                    "Twee nullen staan te praten. Zegt de een tegen de ander: Ben jij ook niets?"
                ],
                verdrietig: [
                    "Het spijt me dat je je zo voelt.",
                    "Soms hebben we gewoon een slechte dag. Morgen wordt beter!",
                    "Ik ben hier voor je, ook al ben ik maar een bot.",
                    "Het is oké om je verdrietig te voelen. Iedereen heeft dat wel eens."
                ],
                vraag: [
                    "Dat is een interessante vraag!",
                    "Daar zou ik even over moeten nadenken...",
                    "Goede vraag! Wat denk jij zelf?",
                    "Daar kan ik lang over praten!"
                ],
                antwoord: [
                    "Dat is een goed antwoord!",
                    "Interessant perspectief!",
                    "Daar had ik nog niet aan gedacht!",
                    "Zo kun je het ook zien!"
                ]
            };
            
            // Laad GitHub reacties
            let githubQA = [];
            try {
                const response = await fetch('https://raw.githubusercontent.com/jimisdebest/ai/main/reacties.txt');
                const text = await response.text();
                
                // Verwerk de tekst: splits op nieuwe regels en verwerk "Vraag = Antwoord" paren
                const lines = text.split('\n');
                for (const line of lines) {
                    if (line.includes('=')) {
                        const [question, answer] = line.split('=').map(part => part.trim());
                        if (question && answer) {
                            githubQA.push({
                                question: question.toLowerCase(),
                                answer: answer,
                                source: 'github'
                            });
                        }
                    }
                }
                
                console.log('GitHub QA paren geladen:', githubQA.length);
            } catch (error) {
                console.error('Fout bij het laden van GitHub reacties:', error);
            }
            
            // Laad zelf geleerde QA paren
            const learnedQA = storedLearnedQA ? JSON.parse(storedLearnedQA) : [];
            
            // Standaard leerpatronen
            const defaultLearnedPatterns = {
                begroeting: ["hallo", "hoi", "hey", "goedendag", "dag", "goedemorgen", "goedenmiddag", "goedenavond"],
                boos: ["dommerd", "stommerd", "idioot", "sukkel", "lul", "boos", "klootzak", "stom", "kut"],
                compliment: ["mooi", "leuk", "geweldig", "fantastisch", "super", "knap", "slim", "grappig"],
                tip: ["tip", "advies", "suggestie", "idee", "aanrader"],
                grap: ["grap", "grappig", "lachen", "mop", "humor", "lach"],
                verdrietig: ["verdrietig", "triest", "somber", "depri", "huilen", "zielig"],
                vraag: ["waarom", "hoe", "wat", "wanneer", "wie", "?", "welke"],
                antwoord: ["omdat", "daarom", "dus", "want", "om"]
            };
            
            // Standaard persoonlijkheid
            const defaultBotPersonality = {
                name: "Combot",
                mood: "blij",
                favoriteWords: ["leuk", "interessant", "geweldig", "grappig"],
                learnedPhrases: [],
                learnedWords: []
            };
            
            // Standaard statistieken
            const defaultStats = {
                totalMessages: 0,
                totalLearned: 0,
                githubResponsesUsed: 0,
                learnedResponsesUsed: 0
            };
            
            // Analyse modus
            const defaultAnalysisMode = storedAnalysisMode ? JSON.parse(storedAnalysisMode) : false;
            
            // Gebruik opgeslagen data of standaard waarden
            return {
                knowledgeBase: storedKnowledgeBase ? JSON.parse(storedKnowledgeBase) : defaultKnowledgeBase,
                learnedPatterns: storedLearnedPatterns ? JSON.parse(storedLearnedPatterns) : defaultLearnedPatterns,
                botPersonality: storedBotPersonality ? JSON.parse(storedBotPersonality) : defaultBotPersonality,
                stats: storedStats ? JSON.parse(storedStats) : defaultStats,
                githubQA: githubQA,
                learnedQA: learnedQA,
                analysisMode: defaultAnalysisMode
            };
        }
        
        // Sla bot data op in Local Storage
        function saveBotData() {
            localStorage.setItem('combotKnowledgeBase', JSON.stringify(knowledgeBase));
            localStorage.setItem('combotLearnedPatterns', JSON.stringify(learnedPatterns));
            localStorage.setItem('combotPersonality', JSON.stringify(botPersonality));
            localStorage.setItem('combotLearnedQA', JSON.stringify(learnedQA));
            localStorage.setItem('combotAnalysisMode', JSON.stringify(analysisMode));
            localStorage.setItem('combotStats', JSON.stringify({
                totalMessages: totalMessages,
                totalLearned: totalLearned,
                githubResponsesUsed: githubResponsesUsed,
                learnedResponsesUsed: learnedResponsesUsed
            }));
        }
        
        // Wis alle opgeslagen data
        function clearBotData() {
            localStorage.removeItem('combotKnowledgeBase');
            localStorage.removeItem('combotLearnedPatterns');
            localStorage.removeItem('combotPersonality');
            localStorage.removeItem('combotStats');
            localStorage.removeItem('combotLearnedQA');
            localStorage.removeItem('combotAnalysisMode');
            
            // Herinitialiseer de bot
            initializeBot().then(botData => {
                knowledgeBase = botData.knowledgeBase;
                learnedPatterns = botData.learnedPatterns;
                botPersonality = botData.botPersonality;
                totalMessages = botData.stats.totalMessages;
                totalLearned = botData.stats.totalLearned;
                githubResponsesUsed = botData.stats.githubResponsesUsed;
                learnedResponsesUsed = botData.stats.learnedResponsesUsed;
                githubQA = botData.githubQA;
                learnedQA = botData.learnedQA;
                analysisMode = botData.analysisMode;
                
                // Update de UI
                updateMemoryList();
                updateAnalysisButton();
                
                // Toon een bevestiging
                addBotMessage("Mijn geheugen is gewist! Ik begin opnieuw met leren.", "Info");
            });
        }
        
        // Initialiseer de bot
        let knowledgeBase, learnedPatterns, botPersonality, stats, githubQA, learnedQA, analysisMode;
        let totalMessages, totalLearned, githubResponsesUsed, learnedResponsesUsed;

        // Elementen
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const hamburgerMenu = document.querySelector('.hamburger-menu');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const learnModeBtn = document.getElementById('learn-mode-btn');
        const analysisBtn = document.getElementById('analysis-btn');
        const memoryList = document.getElementById('memory-list');
        const clearAllMemoryBtn = document.getElementById('clear-all-memory');

        // Variabelen
        let learnMode = false;

        // Spraak functie
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'nl-NL';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 0.3; // 30% volume
                
                window.speechSynthesis.speak(utterance);
            }
        }

        // Hamburger menu functionaliteit
        hamburgerMenu.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Leer nieuwe vraag-antwoord paren
        function learnNewQA(input) {
            if (input.toLowerCase().startsWith('leer ')) {
                const content = input.substring(5).trim();
                if (content.includes('=')) {
                    const [question, answer] = content.split('=').map(part => part.trim());
                    if (question && answer) {
                        // Voeg toe aan geleerde QA
                        learnedQA.push({
                            question: question.toLowerCase(),
                            answer: answer,
                            source: 'geleerd'
                        });
                        
                        // Sla op
                        saveBotData();
                        
                        // Update statistieken
                        totalLearned++;
                        updateMemoryList();
                        
                        return `Bedankt! Ik heb geleerd: als jij "${question}" zegt, zeg ik "${answer}".`;
                    }
                }
                return "Gebruik: leer [vraag] = [antwoord]";
            }
            return null;
        }

        // Verwijder een specifiek geheugen item
        function deleteMemoryItem(index, type) {
            if (type === 'word') {
                botPersonality.learnedWords.splice(index, 1);
            } else if (type === 'qa') {
                learnedQA.splice(index, 1);
            }
            saveBotData();
            updateMemoryList();
            addBotMessage("Item verwijderd uit geheugen.", (Info);
        }

        // Analyseer en vind het beste antwoord
        function findResponseWithAnalysis(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            const analysisSteps = [];
            
            analysisSteps.push("Ik kijk in GitHub voor exacte overeenkomst...");
            
            // Stap 1: Exacte overeenkomst in GitHub
            for (const qa of githubQA) {
                if (lowerMessage === qa.question) {
                    analysisSteps.push("✓ Exacte overeenkomst gevonden. Antwoord geven aan gebruiker.");
                    return { 
                        response: qa.answer, 
                        category: "github", 
                        source: 'github',
                        analysis: analysisSteps
                    };
                }
            }
            
            analysisSteps.push("✗ Geen exacte overeenkomst gevonden.");
            analysisSteps.push("Zoeken in GitHub naar vraag met minimaal 65% overeenkomst...");
            
            // Stap 2: Overeenkomst van 65% of meer in GitHub
            let bestMatch = null;
            let bestSimilarity = 0;
            
            for (const qa of githubQA) {
                const similarity = calculateSimilarity(lowerMessage, qa.question);
                if (similarity > bestSimilarity) {
                    bestSimilarity = similarity;
                    bestMatch = qa;
                }
            }
            
            if (bestMatch && bestSimilarity >= 0.65) {
                analysisSteps.push(`✓ Vraag gevonden met ${Math.round(bestSimilarity * 100)}% overeenkomst: "${bestMatch.question}"`);
                analysisSteps.push("Antwoord geven aan gebruiker.");
                githubResponsesUsed++;
                return { 
                    response: bestMatch.answer, 
                    category: "github", 
                    source: 'github',
                    analysis: analysisSteps
                };
            }
            
            analysisSteps.push("✗ Geen vraag gevonden met minimaal 65% overeenkomst.");
            analysisSteps.push("Werk overlaten aan SmartBot...");
            
            // Stap 3: Fallback naar standaard kennis
            const category = categorizeMessage(userMessage);
            if (knowledgeBase[category] && knowledgeBase[category].length > 0) {
                const response = knowledgeBase[category][Math.floor(Math.random() * knowledgeBase[category].length)];
                analysisSteps.push(`✓ Standaard antwoord gebruikt uit categorie: ${category}`);
                return { 
                    response: response, 
                    category: category, 
                    source: 'knowledge',
                    analysis: analysisSteps
                };
            }
            
            analysisSteps.push("✗ Geen geschikt antwoord gevonden.");
            analysisSteps.push("✓ Fallback antwoord gebruikt.");
            return { 
                response: "Dat is een interessante vraag! Kun je wat meer uitleg geven?", 
                category: "vraag", 
                source: 'fallback',
                analysis: analysisSteps
            };
        }

        // Initialiseer de chat
        window.onload = async function() {
            const botData = await initializeBot();
            knowledgeBase = botData.knowledgeBase;
            learnedPatterns = botData.learnedPatterns;
            botPersonality = botData.botPersonality;
            totalMessages = botData.stats.totalMessages;
            totalLearned = botData.stats.totalLearned;
            githubResponsesUsed = botData.stats.githubResponsesUsed;
            learnedResponsesUsed = botData.stats.learnedResponsesUsed;
            githubQA = botData.githubQA;
            learnedQA = botData.learnedQA;
            analysisMode = botData.analysisMode;
            
            addBotMessage(`Hallo! Ik ben Combot. Ik heb ${githubQA.length} GitHub reacties en ${learnedQA.length} zelf geleerde reacties.`, "Begin van dit gesprek.");
            
            updateMemoryList();
            updateAnalysisButton();
        };

        // Functie om een bericht van de gebruiker toe te voegen
        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user-message';
            messageElement.textContent = message;
            
            chatContainer.appendChild(messageElement);
            scrollToBottom();
            
            learnFromMessage(message);
            totalMessages++;
            saveBotData();
        }

        // Functie om een bericht van de bot toe te voegen
        function addBotMessage(message, category) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message bot-message';
            messageElement.textContent = message;
            
            chatContainer.appendChild(messageElement);
            scrollToBottom();
            
            totalMessages++;
            speakText(message);
            saveBotData();
        }

        // Functie om een analysebericht toe te voegen
        function addAnalysisMessage(steps) {
            const analysisElement = document.createElement('div');
            analysisElement.className = 'message analysis-message';
            
            let analysisHTML = '<strong>Analyse:</strong><br>';
            steps.forEach(step => {
                analysisHTML += `• ${step}<br>`;
            });
            
            analysisElement.innerHTML = analysisHTML;
            chatContainer.appendChild(analysisElement);
            scrollToBottom();
        }

        // Scroll naar beneden
        function scrollToBottom() {
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 100);
        }

        // Denkproces tonen
        function showThinking() {
            const thinkingElement = document.createElement('div');
            thinkingElement.className = 'thinking';
            thinkingElement.id = 'thinking';
            thinkingElement.innerHTML = `
                Combot denkt na
                <div class="thinking-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            chatContainer.appendChild(thinkingElement);
            scrollToBottom();
            
            return thinkingElement;
        }

        // Categoriseer bericht
        function categorizeMessage(message) {
            const lowerMessage = message.toLowerCase();
            for (const category in learnedPatterns) {
                for (const word of learnedPatterns[category]) {
                    if (lowerMessage.includes(word)) {
                        return category;
                    }
                }
            }
            return "random";
        }

        // Leer van bericht
        function learnFromMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            for (const word of words) {
                let wordExists = false;
                for (const cat in learnedPatterns) {
                    if (learnedPatterns[cat].includes(word)) {
                        wordExists = true;
                        break;
                    }
                }
                
                if (!wordExists && word.length > 2 && !isCommonWord(word)) {
                    const category = categorizeMessage(message);
                    if (!learnedPatterns[category]) {
                        learnedPatterns[category] = [];
                    }
                    learnedPatterns[category].push(word);
                    botPersonality.learnedWords.push(word);
                    totalLearned++;
                    
                    if (!knowledgeBase[category]) {
                        knowledgeBase[category] = [];
                    }
                    
                    if (!botPersonality.learnedPhrases.includes(message)) {
                        botPersonality.learnedPhrases.push(message);
                        knowledgeBase[category].push(message);
                    }
                }
            }
            updateMemoryList();
        }

        // Veelvoorkomende woorden filteren
        function isCommonWord(word) {
            const commonWords = ["de", "het", "een", "en", "of", "maar", "dan", "om", "naar", "voor", "met", "zonder", "door", "over", "onder", "boven", "tussen", "naast", "achter", "voor", "bij", "sinds", "tot", "van", "aan", "in", "uit", "op", "te", "bij", "naar"];
            return commonWords.includes(word.toLowerCase());
        }

        // Bereken gelijkenis
        function calculateSimilarity(str1, str2) {
            const words1 = str1.split(' ').filter(word => word.length > 2);
            const words2 = str2.split(' ').filter(word => word.length > 2);
            
            if (words1.length === 0 || words2.length === 0) return 0;
            
            let matches = 0;
            for (const word1 of words1) {
                if (words2.includes(word1)) {
                    matches++;
                }
            }
            
            return matches / Math.max(words1.length, words2.length);
        }

        // Verwerk leerinvoer
        function handleLearnInput(input) {
            const learnResult = learnNewQA(input);
            if (learnResult) {
                addBotMessage(learnResult, "geleerd");
            } else {
                addBotMessage("Gebruik: leer [vraag] = [antwoord] om me iets nieuws te leren!", "Info");
            }
            userInput.value = "";
        }

        // Update geheugenlijst
        function updateMemoryList() {
            memoryList.innerHTML = "";
            
            // Toon geleerde woorden
            botPersonality.learnedWords.forEach((word, index) => {
                const memoryItem = document.createElement('div');
                memoryItem.className = 'memory-item';
                memoryItem.innerHTML = `
                    ${word}
                    <button class="delete-memory" onclick="deleteMemoryItem(${index}, 'word')">×</button>
                `;
                memoryList.appendChild(memoryItem);
            });
            
            // Toon geleerde QA paren
            learnedQA.forEach((qa, index) => {
                const memoryItem = document.createElement('div');
                memoryItem.className = 'memory-item';
                memoryItem.innerHTML = `
                    "${qa.question}"
                    <button class="delete-memory" onclick="deleteMemoryItem(${index}, 'qa')">×</button>
                `;
                memoryList.appendChild(memoryItem);
            });
        }

        // Update analyse knop
        function updateAnalysisButton() {
            analysisBtn.textContent = analysisMode ? "Analyse word niet meer weergegeven." : "Analyse word weergegeven.";
            analysisBtn.classList.toggle('active', analysisMode);
        }

        // Event listeners
        sendBtn.addEventListener('click', function() {
            if (learnMode && userInput.value.toLowerCase().startsWith('leer ')) {
                handleLearnInput(userInput.value);
            } else {
                handleUserInput();
            }
        });

        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (learnMode && userInput.value.toLowerCase().startsWith('leer ')) {
                    handleLearnInput(userInput.value);
                } else {
                    handleUserInput();
                }
            }
        });
        
        learnModeBtn.addEventListener('click', function() {
            learnMode = !learnMode;
            learnModeBtn.textContent = learnMode ? "Normale modus" : "Leermodus";
            learnModeBtn.classList.toggle('active', learnMode);
            userInput.placeholder = learnMode ? "Typ 'leer vraag = antwoord'..." : "Typ je bericht hier...";
            addBotMessage(learnMode ? "Leermodus actief!" : "Leermodus uitgeschakeld.", "Info");
        });
        
        analysisBtn.addEventListener('click', function() {
            analysisMode = !analysisMode;
            updateAnalysisButton();
            saveBotData();
            addBotMessage(`Analyse modus is nu ${analysisMode ? 'ingeschakeld' : 'uitgeschakeld'}.`, "Info");
        });
        
        clearAllMemoryBtn.addEventListener('click', function() {
            if (confirm("Weet je zeker dat je ALLES uit het geheugen wilt verwijderen?")) {
                clearBotData();
            }
        });

        // Verwerk gebruikersinvoer
        function handleUserInput() {
            let message = userInput.value.trim();
            if (message === "") return;
            
            if (message.toLowerCase().startsWith('leer ')) {
                handleLearnInput(message);
                return;
            }
            
            addUserMessage(message);
            
            const thinkingElement = showThinking();
            
            setTimeout(() => {
                thinkingElement.remove();
                
                const { response, category, source, analysis } = findResponseWithAnalysis(message);
                
                if (analysisMode) {
                    addAnalysisMessage(analysis);
                }
                
                addBotMessage(response, category);
                
                userInput.value = "";
                userInput.focus();
                
                saveBotData();
            }, 1500 + Math.random() * 2000);
        }
    </script>
</body>
</html>
